# 3.3 创建数据库与用户

安装MariaDB服务器时,会自动或通过`mysql_install_db`使用工具创建几个默认的数据库与表。

## 1. MariaDB用户账户识别与权限

连接MariaDB服务器时,除用户名称外,用户用于连接的客户端也是认证的一部分.

**1. 用户识别**

MariaDB的用户账户可以看作是绑定的，假如你只注册了`'svc_id'@'127.0.0.1'`这个账户，那么只有安装MariaDB的服务器才能连接上。当然你也可以使用通配符进行配置，`%`符号表示所有IP或主机名，例如以下配置:

```mysql
# 只有对应用户名在指定IP下才能访问
'svc_id'@'192.168.0.10'[该账号的密码为123]
# 对应用户名在所有IP下均可访问
'svc_id'@'%'[该账号的密码为abc]
```

当你在IP地址为`192.168.0.10`的机器上使用`abc`密码登陆时会提示密码错误，应该使用`123`登陆，因为指定IP的范围比通配符的范围小，所以MariaDB会选用指定IP的密码进行认证，这就会引起一些不必要的麻烦。

**2. 权限**

MariaDB服务器中存在多种权限(Privileges),从MariaDB 10.0 开始引入权限组(Role)的概念,一个组包含多个权限。权限可以根据作用范围分为`服务器级权限`、`数据库级权限`、`表级权限`、`存储程序相关的权限`以及`列级权限`(不常用)

为用户赋予权限时，使用GRANT命令，ON子句用于指定数据库对象，如：

```mysql
1. *.*
该对象为整个MariaDB服务器，此时在 privilege_list 中只能用全局权限
2. db1.
该对象为某个特定的数据库，此时在 privilege_list 中可以出现除全局权限外的数据库级、表级、存储程序级权限
3. db1.table1
该对象为某个数据库中的一个表，privilege_list 中只能使用表级权限
4. db1.stored_program1
该对象为某个数据库的一个存储程序，privilege_list 只能使用存储程序级别权限
例子: GRANT privilege_list ON db.TABLE TO 'user'@'host'
```

Example:

```mysql
GRANT [privileges_list] ON [数据库对象] TO 'db_id'@'HOSTNAME | 域名 |IP' IDENTIFIED BY 'password' WITH GRANT OPTION;
# 刷新权限设置,在配置或创建新的用户权限后，通常都会执行刷新命令让权限立即生效
FLUSH PRIVILEGES;
```

+ GRANT语句为某个特定用户分配权限，如果用户不存在，则会先创建用户，然后再赋予权限。所以GRANT语句具有创建用户同时分配权限的作用。
+ privileges_list，指定一个或多个权限，指定多个权限时使用都好（,）进行分隔。
+ ON关键字，指定给那个数据库对象授予权限。
+ TO关键字，指定获得权限的用户。
+ IDENTIFIED BY子句，用于给创建的用户赋予密码的作用。
+ 末尾的WITH GRANT OPTION子句，指定用户可以为其他用户授权的权限。

 **MariaDB中的访问权限**

| 全局权限               |                                          |
| ------------------ | :--------------------------------------- |
| 权限名                | 权限所允许的操作                                 |
| CREATE USER        | 使用高级账户管理语句，创建一个新用户的权限                    |
| FILE               | 使用LOAD DATA INFILE 或 LOAD_FILE()函数访问磁盘文件时所需的权限，读、写 MariaDB 服务器主机上的文件 |
| GRANT OPTION       | 把账户权限授予其他账户(只能将自己有的权限授予其他用户)             |
| PROCESS            | 查看在运行的线程的信息(show processlist)            |
| RELOAD             | 重新加载权限数据或更新日志及缓存(flush)                  |
| REPLICATION CLIENT | 查询主/从服务器的状态(show master status/show slave status) |
| REPLICATION SLAVE  | 以复制的从服务器运行, 连接MariaDB服务器的账号需要有此权限才能查看主服务器的更改 |
| SHOW DATBASES      | 用 SHOW DATABASES 语句查看全部数据库名称             |
| SHUTDOWN           | 关闭服务器                                    |
| SUPER              | 用 KILL 命令终止线程以及进行其他超级用户操作(尽量不要授予普通账号此权限) |

| 数据库级操作权限               |                         |
| ---------------------- | ----------------------- |
| CREATE                 | 创建数据库或数据表               |
| CRATE ROUTINE          | 创建存储函数或存储过程             |
| CREATE TEMPORARY TABLE | 用 TEMPORARY 关键字创建临时表    |
| GRANT OPTION           | 将自己拥有的权限赋予其他用户          |
| DROP                   | 删除数据库、数据表或其他对象          |
| EVENT                  | 为时间调度程序创建、删除或修改各种事件     |
| EXECUTE                | 执行存储函数或存储过程             |
| LOCK TABLE             | 用 LOCK TABLE 语句明确地锁定数据表 |
| REFERENCE              | 未使用（保留字）                |
| SELECT                 | 检索数据表里的数据行              |
| SHOW VIEW              | 查看视图的定义                 |
| TRGGER                 | 创建或删除触发器                |
| UPDATE                 | 修改数据行                   |

| 数据库表级操作权限              |                         |
| ---------------------- | ----------------------- |
| ALTER                  | 更改数据表或索引的定义             |
| ALTER ROUTINE          | 更改或删除存储函数或存储过程          |
| CREATE                 | 创建数据库或数据表               |
| CRATE ROUTINE          | 创建存储函数或存储过程             |
| CREATE TEMPORARY TABLE | 用 TEMPORARY 关键字创建临时表    |
| CREATE VIEW            | 创建视图                    |
| DELETE                 | 删除数据库中现有的数据行            |
| DROP                   | 删除数据库、数据表或其他对象          |
| EVENT                  | 为时间调度程序创建、删除或修改各种事件     |
| EXECUTE                | 执行存储函数或存储过程             |
| INDEX                  | 创建或删除索引                 |
| INSERT                 | 往数据表中插入新数据行             |
| LOCK TABLE             | 用 LOCK TABLE 语句明确地锁定数据表 |
| REFERENCE              | 未使用（保留字）                |
| SELECT                 | 检索数据表里的数据行              |
| SHOW VIEW              | 查看视图的定义                 |
| TRGGER                 | 创建或删除触发器                |
| UPDATE                 | 修改数据行                   |

| 存储过程级权限       |                |
| ------------- | -------------- |
| ALTER ROUTINE | 更改或删除存储函数或存储过程 |
| EXECUTE       | 执行存储函数或存储过程    |
| GRANT OPTION  | 将自己拥有的权限赋予其他用户 |